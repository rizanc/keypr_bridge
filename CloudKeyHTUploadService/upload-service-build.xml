<project name="UploadService" default="uploadServiceDist" basedir=".">
	<description>
		This ant build file creates jar of CloudKeyHTUploadService project. It places the created jar whererver
		it is required.
    </description>
	<!-- set global properties for this build -->
	<property name="upload.service.src" location="./src" />
	<property name="upload.service.res" location="./res" />
	<property name="upload.service.lib" location="./lib" />
	<property name="upload.service.build" location="./build" />
	<property name="upload.service.build.res" location="${upload.service.build}/res" />
	<property name="upload.service.build.lib" location="${upload.service.build}/lib" />
	<property name="upload.service.dist" location="./dist" />
	<property name="upload.service.dist.lib" location="${upload.service.dist}/lib" />

	<target name="init">
		<!-- Create the time stamp -->
		<tstamp />
		<!-- Create the build directory structure used by compile -->
		<mkdir dir="${upload.service.build}" />
		<mkdir dir="${upload.service.build.res}" />
		<mkdir dir="${upload.service.build.lib}" />
		<echo message="build directory created"/>
		<!-- Create the distribution directory -->
		<mkdir dir="${upload.service.dist.lib}" />
	</target>
	<!-- set the class path to compile -->
	<path id='compile.classpath'>
		<fileset dir='lib'>
			<include name='*.jar' />
		</fileset>
	</path>

	<!-- To delete the folders created on initialization -->
	<target name="clean" description="clean up">
		<!-- Delete the ${upload.service.build} and ${upload.service.dist} directory trees -->
		<delete dir="${upload.service.build}" failonerror="false" />
		<delete dir="${upload.service.dist}" failonerror="false"/>
	
	</target>

	<!-- To compile source and add required files to be included in jar -->
	<target name="compile" depends="init" description="compile the source ">
		<!-- Compile the java code from ${upload.service.src} into ${upload.service.build} -->
		<javac includeantruntime="false" srcdir="${upload.service.src}" destdir="${upload.service.build}">
			<classpath refid="compile.classpath" />
		</javac>
		<!-- Copy the res folder to be included in jar  -->
		<copy todir="${upload.service.build}/res">
			<fileset dir="${upload.service.res}">
				<include name="*.*" />
				<type type="file" />
			</fileset>
		</copy>
		<!-- Copy the lib folder to be included in jar  -->
		<copy todir="${upload.service.build}/lib">
			<fileset dir="${upload.service.lib}">
				<include name="*.jar" />
				<type type="file" />
			</fileset>
		</copy>
		<!-- Copy the .classpath and .project to be included in jar  -->
		<copy todir="${upload.service.build}">
			<fileset dir="${basedir}">
				<include name=".project" />
				<type type="file" />
			</fileset>
		</copy>
	</target>

	<target name="uploadServiceDist" depends="clean,init,compile,run" description="generate the distribution">
		<!-- Put everything in ${upload.service.build} into the upload-service.jar -->
		<jar jarfile="${upload.service.dist}/lib/upload-service.jar" basedir="${upload.service.build}">
			<manifest>
				<attribute name="Main-Class" value="com.cloudkey.upload.service.UploadServiceInitiater"/>
			</manifest>
			<zipgroupfileset dir="${upload.service.lib}" includes="**/*.jar" />
		</jar>

	</target>
	<target name="run" depends="compile">
	</target>
	
</project>